# Операционные системы UNIX/Linux (Базовый).

Установка и обновления системы Linux. Основы администрирования.

## Part 1. Установка ОС

**== Задание ==**
##### Установить **Ubuntu 20.04 Server LTS** без графического интерфейса. (Используем программу для виртуализации - VirtualBox)

- Узнайте версию Ubuntu, выполнив команду 
`cat /etc/issue.`
- Вставьте скриншот с выводом команды.
![part1](part1.png)
## Part 2. Создание пользователя
**== Задание ==**
##### Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу `adm`.

- Вставьте скриншот вызова команды для создания пользователя.
![part2.1](part2.png)
![part2.2](part2_3.png)
- Новый пользователь должен быть в выводе команды \
`cat /etc/passwd`
- Вставьте скриншот с выводом команды.
![part2.3](part2_2.png)

## Part 3. Настройка сети ОС
**== Задание ==**
##### Задать название машины вида user-1  
![part3.1](part3_1.png)
##### Установить временную зону, соответствующую вашему текущему местоположению.  
![part3.2](part3_2.png)
##### Вывести названия сетевых интерфейсов с помощью консольной команды.

![part3.3](part3_3.png)

- В отчёте дать объяснение наличию интерфейса lo.  

![part3.4](part3_4.png)

##### Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера. 
![part3.5](part3_5.png)
- В отчёте дать расшифровку DHCP. 

DHCP (англ. Dynamic Host Configuration Protocol — протокол динамической настройки узла) — прикладной протокол, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP. Данный протокол работает по модели «клиент-сервер». Для автоматической конфигурации компьютер-клиент на этапе конфигурации сетевого устройства обращается к так называемому серверу DHCP и получает от него нужные параметры. Сетевой администратор может задать диапазон адресов, распределяемых сервером среди компьютеров. Это позволяет избежать ручной настройки компьютеров сети и уменьшает количество ошибок. Протокол DHCP используется в большинстве сетей TCP/IP.

DHCP является расширением протокола BOOTP, использовавшегося ранее для обеспечения бездисковых рабочих станций IP-адресами при их загрузке. DHCP сохраняет обратную совместимость с BOOTP. 
##### Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 
![part3.6](part3_6.png)
![part3.7](part3_7.png)
##### Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8). 
 sudo nano /etc/netplan/00-installer-config.yaml
 ![part3.8](part3_8.png)

 ![part3.9](part3_9.png)
##### Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.  

- В отчёте опишите, что сделали для выполнения всех семи пунктов (можно как текстом, так и скриншотами).
- Успешно пропинговать удаленные хосты 1.1.1.1 и ya.ru и вставить в отчёт скрин с выводом команды. В выводе команды должна быть фраза "0% packet loss".
 ![part3.10](part3_10.png)

## Part 4. Обновление ОС
**== Задание ==**
##### Обновить системные пакеты до последней на момент выполнения задания версии.  

- После обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют.
- Вставить скриншот с этим сообщением в отчёт.
![part4.1](part4_1.png)

## Part 5. Использование команды **sudo**
**== Задание ==**
##### Разрешить пользователю, созданному в [Part 2](#part-2-создание-пользователя), выполнять команду sudo.
su user2
sudo touch /etc/sudoers.d/user2
sudo nano /etc/sudoers.d/user2
user2 ALL=(ALL:ALL) ALL
![part5.1](part5_1.png)
- В отчёте объяснить *истинное* назначение команды sudo (про то, что это слово - "волшебное", писать не стоит). 
sudo (англ. Substitute User and do, дословно «подменить пользователя и выполнить») — программа для системного администрирования UNIX-систем, позволяющая делегировать те или иные привилегированные ресурсы пользователям с ведением протокола работы. Основная идея — дать пользователям как можно меньше прав, при этом достаточных для решения поставленных задач. Программа поставляется для большинства UNIX и UNIX-подобных операционных систем.

  Команда sudo предоставляет возможность пользователям выполнять команды от имени суперпользователя root, либо других пользователей. Правила, используемые sudo для принятия решения о предоставлении доступа, находятся в файле /etc/sudoers (для редактирования файла можно использовать специальный редактор visudo, запускаемый из командной строки без параметров, в том числе без указания пути к файлу); язык их написания и примеры использования подробно изложены в man sudoers.

  В большинстве случаев грамотная настройка sudo делает небезопасную работу от имени суперпользователя ненужной. Все действия оказываются выполнимы из-под аккаунта пользователя, которому разрешено использовать sudo без ограничений. Имеется возможность запрещать и разрешать определённым пользователям или группам выполнение конкретного набора программ, а также разрешить выполнение определённых программ без необходимости ввода своего пароля. 
- Поменять hostname ОС от имени пользователя, созданного в пункте [Part 2](#part-2-создание-пользователя) (используя sudo).
- Вставить скрин с изменённым hostname в отчёт.
sudo nano /etc/hostname
![part5.2](part5_2.png)

## Part 6. Установка и настройка службы времени
**== Задание ==**

##### Настроить службу автоматической синхронизации времени.  
sudo apt install -y ntp
dpkg -l | grep "ntp"
sudo apt update
ntpq -p
sudo systemctl stop ntp
sudo ntpd -gq
![part6.1](part6_1.png)
- Вставить скрины с корректным временем и выводом команды в отчёт.
![part6.1](part6_2.png)
## Part 7. Установка и использование текстовых редакторов 
**== Задание ==**
##### Установить текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  
##### Используя каждый из трех выбранных редакторов, создайте файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.  
- В отчёт вставьте скриншоты:
  - Из каждого редактора с содержимым файла перед закрытием.
- В отчёте укажите, что сделали для выхода с сохранением изменений.
VIM: :wq
![part7.1](part7_1.png)

NANO: ctrl+x -> У -> enter
![part7.2](part7_2.png)

joe: ctrl + K X
![part7.3](part7_3.png)

##### Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.
- В отчёт вставьте скриншоты:
    - Из каждого редактора с содержимым файла после редактирования.
- В отчёте укажите, что сделали для выхода без сохранения изменений.

VIM: :q!
![part7.4](part7_4.png)

NANO: ctrl+x -> n -> enter
![part7.5](part7_5.png)

joe: ctrl + k -> q -> n 
![part7.6](part7_6.png)


##### Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.
- В отчёт вставьте скриншоты:
    - Из каждого редактора с результатами поиска слова.
    - Из каждого редактора с командами, введёнными для замены слова на другое.
VIM: :/bernardi
![part7.7](part7_7.png)
![part7.8](part7_8.png)

NANO: ctrl+\bernardi  
![part7.9](part7_9.png)

JOE: ctrl + k -> f -> r -> enter / 21_School_21 -> enter -> Y 
![part7.10](part7_10.png)

## Part 8. Установка и базовая настройка сервиса **SSHD**
**== Задание ==**
##### Установить службу SSHd. 
##### Добавить автостарт службы при загрузке системы.  
##### Перенастроить службу SSHd на порт 2022.  
##### Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.
- В отчёте объяснить значение команды и каждого ключа в ней.
##### Перезагрузить систему.

Настройка SSHD:

Заходим по нашим пользователем в окне virtualbox и вводим команду:
sudo nano /etc/ssh/sshd_config
Удаляем комментарий рядом с надписью #Port 22 и меняем цифру 22 на 2022. Так же разрешаем логиниться под root.
Далее разрешаем как логин по ключу, так и логин по паролю:
Сохраняем, закрываем, перезапускаем демона.
После проверяем что демон перезапустился, командой sudo service sshd status

Настройка файервола:

sudo ufw status -> status inactive
sudo: ufw: command not found -> sudo apt install -y ufw
активируем его командой sudo ufw enable -> Firewall is active and enable on system startup
sudo ufw allow 2022
Rule added
Rule added (V6)

Удалённое подключение:
terminal -> ssh bernardi@localhost -p 2022

Генерация ключей:
terminal -> cd .ssh
mkdir ubuntu_01
cd ubuntu_01 && pwd
ssh-keygen
вставляем путь из pwd
Передать сгенерированный ключ нашему хосту:
ssh-copy-id -i id_rsa.pub user@localhost -p 2022

Создание конфига ssh:
nano ~/.ssh/config
Host localhost
  IdentityFile ~/.ssh/ubuntu_01/id_rsa

sudo nano /etc/ssh/sshd_config
снимаем коммент со строки AuthorizedKeysFile
клмментируем строку PasswordAuthentication
рестарт
sudo service sshd restart
control + d

- В отчёте опишите, что сделали для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).
- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \
(если команды netstat нет, то ее нужно установить)
- Скрин с выводом команды вставить в отчёт.
- В отчёте объяснить значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.

ps aux | grep sshd
a - указывает ps вывести на дисплей процессы всех пользователей, за исключением тех процессов, которые не связаны с терминалом и процессами группы лидеров.
u — подставки для ориентированных на пользователя формате, который обеспечивает подробную информацию о процессах.
x - ps перечисляет процессы без управляющего терминала. В основном это процессы, которые запускаются во время загрузки и работают в фоновом режиме.

![part8.1](part8_1.png)

nano /etc/ssh/sshd_config
netstat -tan
![part8.2](part8_2.png)
![part8.3](part8_3.png)

netstat (network statistics) — утилита командной строки, выводящая на дисплей состояние TCP-соединений (как входящих, так и исходящих), таблицы маршрутизации, число сетевых интерфейсов и сетевую статистику по протоколам. Доступна в операционных системах семейства UNIX и Windows. Основное назначение утилиты — поиск сетевых проблем и определение производительности сети.
-t : Показать ссылку, к которой подключен TCP
-a : Все статусы
-n : Отображение IP и ПОРТА в цифровом формате

proto - Протокол (обычно unix), используемый сокетом.

Recv-Q - Счётчик байт не скопированных программой пользователя из этого сокета.

Send-Q - Счётчик байтов, не подтверждённых удалённым узлом.

Local Address - Адрес и номер порта локального конца сокета. Если не указана опция --numeric (-n), адрес сокета преобразуется в каноническое имя узла (FQDN), и номер порта преобразуется в соответствующее имя службы.

Foreign Address - Адрес и номер порта удалённого конца сокета. Аналогично "Local Address."

state Состояние сокета. Поскольку в режиме raw нет состояний, а в режиме UDP состояния обычно не испольуются, эта колонка может оставаться пустой. Обычно состояние может принимать одно из нескольких значений:

ESTABLISHED - соединение установлено
SYN_SENT - сокет пытается установить соединение
SYN_RECV - начальная синхронизация соединения
FIN_WAIT1 - сокет закрыт, ожидание отключения соединения
FIN_WAIT2 - ожидание отключения удаленной стороны
TIME_WAIT - ожидание после закрытия повторной передачи отключения удаленной стороны
CLOSED - соединение закрыто, сокет не используется
CLOSE_WAIT - удаленный узел отключился, сокет скоро будет закрыт
LAST_ACK - сначала отключилась удаленная сторона, а затем сокет будет закрыт
LISTEN - сокет ожидает входящих соединений
CLOSING - закрытие сокета, точнее сокет закрыт, а затем отключился удаленный узел
UNKNOWN - состояние сокета неизвестно.

IP-адрес 0.0.0.0 — это немаршрутизируемый адрес IPv4, который можно использовать в разных целях, в основном, в качестве адреса по умолчанию или адреса-заполнителя. Несмотря на то, что адрес 0.0.0.0 может использоваться в компьютерных сетях, он не является адресом какого-либо устройства.

## Part 9. Установка и использование утилит **top**, **htop**
**== Задание ==**
##### Установить и запустить утилиты top и htop.  
- По выводу команды top определить и написать в отчёте:
  - uptime
  - количество авторизованных пользователей
  - общую загрузку системы
  - общее количество процессов
  - загрузку cpu
  - загрузку памяти
  - pid процесса занимающего больше всего памяти
  - pid процесса, занимающего больше всего процессорного времени

sudo apt install htop
![part9.1](part9_1.png)
Uptime - 3.13 min время обновляется каждую минуту;
Количество авторизованных пользователей - 2 users
Общаю загрузку системы - строка load average: серьезные процессы не запущены 0,00, 0,00, 0,00;
Общее количество процессов 109 total, 1 running, 108 sleeping;
Загрузка cpu - %Cpu(s): 0,0 us;
Загрузка памяти - MiB Mem : 1983,2 total;
pid процесса занимающего больше всего памяти  Shift + M -> PID 3171
![part9.2](part9_2.png)
pid процесса, занимающего больше всего процессорного времени - это та самая базовая сортировка, которая была у нас изначально. Так что выйдем из top при помощи клавищи q и ещё раз запустим top. 
![part9.3](part9_3.png) PID 1

- В отчёт вставить скрин с выводом команды htop:

  - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
  - отфильтрованному для процесса sshd
  - с процессом syslog, найденным, используя поиск 
  - с добавленным выводом hostname, clock и uptime  

отсортированному по PID

![part9.4](part9_4.png)

PERCENT_CPU

![part9.5](part9_5.png) 

PERCENT_MEM

![part9.6](part9_6.png) 

TIME

![part9.7](part9_7.png)

Отфильтрованному для процесса sshd
![part9.8](part9_8.png)

  - с процессом syslog, найденным, используя поиск 
![part9.9](part9_9.png)
  - с добавленным выводом hostname, clock и uptime  
![part9.10](part9_10.png)

## Part 10. Использование утилиты **fdisk**
**== Задание ==**
##### Запустить команду fdisk -l.
sudo fdisk -l
![part10.1](part10_1.png)

- В отчёте написать название жесткого диска, его размер и количество секторов, а также размер swap.
/dev/sda
10 GiB  
20971520 sectors
sudo swapon --show
![part10.2](part10_2.png)

## Part 11. Использование утилиты **df** 
**== Задание ==**
##### Запустить команду df.  
- В отчёте написать для корневого раздела (/):
  - размер раздела - 8408452;
  - размер занятого пространства - 4192740;
  - размер свободного пространства - 3766996;
  - процент использования - 53%;
- Определить и написать в отчёт единицу измерения в выводе - блок 512 байт;
![part11.1](part11_1.png)

##### Запустить команду df -Th.
- В отчёте написать для корневого раздела (/):
    - размер раздела 8.1G;
    - размер занятого пространства 4.0G;
    - размер свободного пространства 3.6G;
    - процент использования 53%;
- Определить и написать в отчёт тип файловой системы для раздела. ext4
![part11.2](part11_2.png)
## Part 12. Использование утилиты **du**
**== Задание ==**
##### Запустить команду du.
##### Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)
du -bh /home
![part12.1](part12_1.png)

du -bh /var
![part12.2](part12_2.png)

du -bh /var/log
![part12.3](part12_3.png)

##### Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)
- В отчёт вставить скрины с выводом всех использованных команд.
du -bh /var/log/*
![part12.4](part12_4.png)

## Part 13. Установка и использование утилиты **ncdu**
**== Задание ==**
##### Установить утилиту ncdu.
##### Вывести размер папок /home, /var, /var/log.
- Размеры должны примерно совпадать с полученными в [Part 12](#part-12-использование-утилиты-du).
- В отчёт вставить скрины с выводом использованных команд.
ncdu /
![part13.1](part13_1.png)
![part13.2](part13_2.png)
![part13.3](part13_3.png)

## Part 14. Работа с системными журналами
**== Задание ==**
##### Открыть для просмотра:
tail
##### 1. /var/log/dmesg
![part14.0](part14_0.png)
##### 2. /var/log/syslog
![part14.1](part14_1.png)
##### 3. /var/log/auth.log  
![part14.2](part14_2.png)
- Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему.
![part14.3](part14_3.png)
Nov 23 12:06:23 user-1 sudo

- Перезапустить службу SSHd.
sudo service sshd restart
- Вставить в отчёт скрин с сообщением о рестарте службы (искать в логах).
![part14.4](part14_4.png)

## Part 15. Использование планировщика заданий **CRON**
**== Задание ==**
##### Используя планировщик заданий, запустите команду uptime через каждые 2 минуты.
- Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении.
![part15.0](part15_0.png)
- Вывести на экран список текущих заданий для CRON.
crontab -e
- Вставить в отчёт скрины со строчками о выполнении и списком текущих задач.
![part15.1](part15_1.png)
##### Удалите все задания из планировщика заданий.
- В отчёт вставьте скрин со списком текущих заданий для CRON.
![part15.2](part15_2.png)

💡 [Нажми тут](https://forms.yandex.ru/u/6357f435c09c02345cf48f1a/), **чтобы поделиться с нами обратной связью на этот проек**т. Это анонимно и поможет команде Педаго сделать твоё обучение лучше.
